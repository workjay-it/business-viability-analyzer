<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Viability Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">üöÄ Business Viability Analyzer</h1>
            <p class="text-gray-600">AI-powered analysis of business success probability using real-time market research</p>
        </div>

        <!-- API Key Setup -->
        <div id="apiKeySetup" class="bg-white rounded-xl shadow-lg p-8 mb-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">üîë Setup Your API Key</h2>
            <p class="text-gray-600 mb-4">To use this tool, you need a free Anthropic API key. Don't worry - Anthropic provides free credits!</p>
            
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                <h3 class="font-semibold text-blue-900 mb-2">How to get your free API key:</h3>
                <ol class="list-decimal list-inside text-sm text-blue-800 space-y-1">
                    <li>Go to <a href="https://console.anthropic.com" target="_blank" class="underline font-medium">console.anthropic.com</a></li>
                    <li>Sign up for a free account</li>
                    <li>Navigate to "API Keys" section</li>
                    <li>Click "Create Key" and copy it</li>
                    <li>Paste it below</li>
                </ol>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Your Anthropic API Key</label>
                    <input 
                        type="password" 
                        id="apiKey" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-mono text-sm"
                        placeholder="sk-ant-api03-..."
                    />
                    <p class="text-xs text-gray-500 mt-1">Your key is stored locally in your browser and never sent anywhere except Anthropic's API</p>
                </div>

                <button 
                    id="saveApiKey"
                    class="w-full bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors"
                >
                    Save API Key & Continue
                </button>
            </div>
        </div>

        <!-- Input Form -->
        <div id="businessForm" class="hidden bg-white rounded-xl shadow-lg p-8 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-semibold text-gray-800">Enter Your Business Idea</h2>
                <button id="changeApiKey" class="text-sm text-indigo-600 hover:text-indigo-800">Change API Key</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Business Concept</label>
                    <textarea 
                        id="businessIdea" 
                        rows="3" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="e.g., An eco-friendly coffee shop that also sells sustainable products"
                    ></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Target Country/Region</label>
                    <input 
                        type="text" 
                        id="country" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="e.g., United States, India, Germany"
                    />
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Industry/Category (Optional)</label>
                    <input 
                        type="text" 
                        id="industry" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="e.g., Food & Beverage, Tech, Retail"
                    />
                </div>

                <button 
                    id="analyzeBtn"
                    class="w-full bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"
                >
                    Analyze Business Viability
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading" class="hidden bg-white rounded-xl shadow-lg p-8 mb-6">
            <div class="flex items-center justify-center space-x-3">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                <p class="text-gray-600 font-medium">Analyzing your business idea... This may take 30-60 seconds</p>
            </div>
            <p class="text-sm text-gray-500 mt-4 text-center">Searching the web for market data, competition, and success stories...</p>
        </div>

        <!-- Results Container -->
        <div id="results" class="hidden space-y-6">
            <!-- Success Score -->
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Success Probability</h2>
                <div class="flex items-center justify-center mb-4">
                    <div class="relative w-48 h-48">
                        <svg class="transform -rotate-90 w-48 h-48">
                            <circle cx="96" cy="96" r="88" stroke="#e5e7eb" stroke-width="16" fill="none"/>
                            <circle id="scoreCircle" cx="96" cy="96" r="88" stroke="#4f46e5" stroke-width="16" fill="none"
                                stroke-dasharray="552.92" stroke-dashoffset="552.92" stroke-linecap="round"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="text-center">
                                <div id="scoreValue" class="text-5xl font-bold text-gray-800">--</div>
                                <div class="text-sm text-gray-500">out of 100</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="scoreInterpretation" class="text-center text-gray-600 font-medium"></div>
            </div>

            <!-- Analysis Sections -->
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">üìä Market Analysis</h3>
                <div id="marketAnalysis" class="text-gray-700 whitespace-pre-wrap"></div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-8">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">üí∞ Revenue Potential</h3>
                <div id="revenueAnalysis" class="text-gray-700 whitespace-pre-wrap"></div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-8">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">üèÜ Competition Overview</h3>
                <div id="competitionAnalysis" class="text-gray-700 whitespace-pre-wrap"></div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-8">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">üìà Success & Failure Examples</h3>
                <div id="examplesAnalysis" class="text-gray-700 whitespace-pre-wrap"></div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-8">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">üéØ How to Start in 2026</h3>
                <div id="startupGuide" class="text-gray-700 whitespace-pre-wrap"></div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-8">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">‚ö†Ô∏è Key Risk Factors</h3>
                <div id="riskFactors" class="text-gray-700 whitespace-pre-wrap"></div>
            </div>
        </div>

        <!-- Error Display -->
        <div id="error" class="hidden bg-red-50 border border-red-200 rounded-xl p-6">
            <h3 class="text-red-800 font-semibold mb-2">Analysis Error</h3>
            <p id="errorMessage" class="text-red-700"></p>
        </div>
    </div>

    <script>
        // API Key Management
        const apiKeySetup = document.getElementById('apiKeySetup');
        const businessForm = document.getElementById('businessForm');
        const saveApiKeyBtn = document.getElementById('saveApiKey');
        const changeApiKeyBtn = document.getElementById('changeApiKey');
        const apiKeyInput = document.getElementById('apiKey');

        // Check if API key exists on load
        window.addEventListener('DOMContentLoaded', () => {
            const savedKey = localStorage.getItem('anthropic_api_key');
            if (savedKey) {
                apiKeySetup.classList.add('hidden');
                businessForm.classList.remove('hidden');
            }
        });

        // Save API key
        saveApiKeyBtn.addEventListener('click', () => {
            const key = apiKeyInput.value.trim();
            if (!key) {
                alert('Please enter your API key');
                return;
            }
            if (!key.startsWith('sk-ant-')) {
                alert('Invalid API key format. Anthropic keys start with "sk-ant-"');
                return;
            }
            localStorage.setItem('anthropic_api_key', key);
            apiKeySetup.classList.add('hidden');
            businessForm.classList.remove('hidden');
            apiKeyInput.value = '';
        });

        // Change API key
        changeApiKeyBtn.addEventListener('click', () => {
            if (confirm('Do you want to change your API key?')) {
                localStorage.removeItem('anthropic_api_key');
                businessForm.classList.add('hidden');
                apiKeySetup.classList.remove('hidden');
            }
        });

        // Main analysis logic
        const analyzeBtn = document.getElementById('analyzeBtn');
        const loading = document.getElementById('loading');
        const results = document.getElementById('results');
        const error = document.getElementById('error');

        analyzeBtn.addEventListener('click', async () => {
            const businessIdea = document.getElementById('businessIdea').value.trim();
            const country = document.getElementById('country').value.trim();
            const industry = document.getElementById('industry').value.trim();

            if (!businessIdea || !country) {
                alert('Please enter both a business idea and target country.');
                return;
            }

            // Reset UI
            results.classList.add('hidden');
            error.classList.add('hidden');
            loading.classList.remove('hidden');
            analyzeBtn.disabled = true;

            try {
                const analysis = await analyzeBusinessViability(businessIdea, country, industry);
                displayResults(analysis);
            } catch (err) {
                showError(err.message);
            } finally {
                loading.classList.add('hidden');
                analyzeBtn.disabled = false;
            }
        });

        async function analyzeBusinessViability(idea, country, industry) {
            const apiKey = localStorage.getItem('anthropic_api_key');
            if (!apiKey) {
                throw new Error('No API key found. Please set up your API key first.');
            }

            const industryText = industry ? ` in the ${industry} industry` : '';
            
            const prompt = `You are a business analyst. Analyze this business idea: "${idea}" for ${country}${industryText}.

Please provide:

1. SUCCESS PROBABILITY SCORE (0-100): Give a numerical score based on market conditions, competition, barriers to entry, and historical success rates of similar businesses. Be realistic and data-driven.

2. MARKET ANALYSIS: Research current market size, growth trends, demand indicators, and market saturation for this type of business in ${country} in 2026.

3. REVENUE POTENTIAL: Research and estimate realistic monthly/annual revenue ranges for similar businesses. Include startup costs and profitability timeline.

4. COMPETITION: Identify major competitors and the competitive landscape. How crowded is this market?

5. SUCCESS & FAILURE EXAMPLES: Find real examples of similar businesses that succeeded or failed, with specific reasons and revenue data where available.

6. HOW TO START IN 2026: Practical steps to launch this business in ${country} considering 2026 regulations, technology, and market conditions.

7. KEY RISK FACTORS: What could cause this business to fail?

Format your response EXACTLY as follows:
SCORE: [number 0-100]
SCORE_REASONING: [one sentence explaining the score]

MARKET_ANALYSIS:
[your analysis]

REVENUE_POTENTIAL:
[your analysis]

COMPETITION:
[your analysis]

EXAMPLES:
[your analysis]

STARTUP_GUIDE:
[your analysis]

RISKS:
[your analysis]`;

            const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "x-api-key": apiKey,
                    "anthropic-version": "2023-06-01"
                },
                body: JSON.stringify({
                    model: "claude-sonnet-4-20250514",
                    max_tokens: 4000,
                    messages: [
                        { 
                            role: "user", 
                            content: prompt 
                        }
                    ],
                    tools: [
                        {
                            "type": "web_search_20250305",
                            "name": "web_search"
                        }
                    ]
                })
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                if (response.status === 401) {
                    throw new Error('Invalid API key. Please check your API key and try again.');
                }
                throw new Error(`API error: ${errorData.error?.message || response.statusText}`);
            }

            const data = await response.json();
            
            // Extract text from response
            let fullText = '';
            for (const block of data.content) {
                if (block.type === 'text') {
                    fullText += block.text + '\n';
                }
            }

            return parseAnalysis(fullText);
        }

        function parseAnalysis(text) {
            const sections = {
                score: 50,
                scoreReasoning: 'Analysis incomplete',
                marketAnalysis: '',
                revenueAnalysis: '',
                competitionAnalysis: '',
                examplesAnalysis: '',
                startupGuide: '',
                riskFactors: ''
            };

            // Extract score
            const scoreMatch = text.match(/SCORE:\s*(\d+)/i);
            if (scoreMatch) {
                sections.score = parseInt(scoreMatch[1]);
            }

            // Extract score reasoning
            const reasoningMatch = text.match(/SCORE_REASONING:\s*(.+?)(?=\n\n|\n[A-Z_]+:)/s);
            if (reasoningMatch) {
                sections.scoreReasoning = reasoningMatch[1].trim();
            }

            // Extract other sections
            const marketMatch = text.match(/MARKET_ANALYSIS:\s*(.+?)(?=\n\n[A-Z_]+:|$)/s);
            if (marketMatch) sections.marketAnalysis = marketMatch[1].trim();

            const revenueMatch = text.match(/REVENUE_POTENTIAL:\s*(.+?)(?=\n\n[A-Z_]+:|$)/s);
            if (revenueMatch) sections.revenueAnalysis = revenueMatch[1].trim();

            const competitionMatch = text.match(/COMPETITION:\s*(.+?)(?=\n\n[A-Z_]+:|$)/s);
            if (competitionMatch) sections.competitionAnalysis = competitionMatch[1].trim();

            const examplesMatch = text.match(/EXAMPLES:\s*(.+?)(?=\n\n[A-Z_]+:|$)/s);
            if (examplesMatch) sections.examplesAnalysis = examplesMatch[1].trim();

            const startupMatch = text.match(/STARTUP_GUIDE:\s*(.+?)(?=\n\n[A-Z_]+:|$)/s);
            if (startupMatch) sections.startupGuide = startupMatch[1].trim();

            const risksMatch = text.match(/RISKS:\s*(.+?)$/s);
            if (risksMatch) sections.riskFactors = risksMatch[1].trim();

            return sections;
        }

        function displayResults(analysis) {
            results.classList.remove('hidden');

            // Animate score circle
            const scoreValue = document.getElementById('scoreValue');
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreInterpretation = document.getElementById('scoreInterpretation');
            
            const score = analysis.score;
            const circumference = 552.92;
            const offset = circumference - (score / 100) * circumference;
            
            scoreValue.textContent = score;
            scoreCircle.style.strokeDashoffset = offset;
            
            // Color coding
            if (score >= 70) {
                scoreCircle.style.stroke = '#10b981';
                scoreInterpretation.innerHTML = `<span class="text-green-600">‚úì High Success Probability</span><br><span class="text-sm">${analysis.scoreReasoning}</span>`;
            } else if (score >= 50) {
                scoreCircle.style.stroke = '#f59e0b';
                scoreInterpretation.innerHTML = `<span class="text-amber-600">‚ö† Moderate Success Probability</span><br><span class="text-sm">${analysis.scoreReasoning}</span>`;
            } else {
                scoreCircle.style.stroke = '#ef4444';
                scoreInterpretation.innerHTML = `<span class="text-red-600">‚ö† Low Success Probability</span><br><span class="text-sm">${analysis.scoreReasoning}</span>`;
            }

            // Populate sections
            document.getElementById('marketAnalysis').textContent = analysis.marketAnalysis || 'No data available';
            document.getElementById('revenueAnalysis').textContent = analysis.revenueAnalysis || 'No data available';
            document.getElementById('competitionAnalysis').textContent = analysis.competitionAnalysis || 'No data available';
            document.getElementById('examplesAnalysis').textContent = analysis.examplesAnalysis || 'No data available';
            document.getElementById('startupGuide').textContent = analysis.startupGuide || 'No data available';
            document.getElementById('riskFactors').textContent = analysis.riskFactors || 'No data available';

            // Scroll to results
            results.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function showError(message) {
            error.classList.remove('hidden');
            document.getElementById('errorMessage').textContent = message;
            error.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    </script>
</body>
</html>
